name: Unit Verification
run-name: >-
    ${{ 
        github.event_name == 'pull_request' 
        && format('Unit Test Verification for CI: PR #{0} -> {1}', github.event.number, github.event.pull_request.title)
    }}
on:
    pull_request:
        types: [opened, synchronize, reopened]

permissions:
    contents: read

concurrency:
    group: ${{ github.workflow }}-pr-${{ github.event.pull_request.number }}
    cancel-in-progress: true

jobs:
    unit-ci-test:
        name: Testing
        runs-on: ubuntu-latest
        timeout-minutes: 30

        steps:
        - name: ğŸ“¥ Git -- Checkout repository
          uses: actions/checkout@v6

        - name: ğŸ“˜ Go -- Set up
          uses: actions/setup-go@v6
          with:
            go-version-file: 'go.mod'
            cache: true

        - name: ğŸ“¦ Go -- Install Dependencies
          run: go mod download

        - name: ğŸ§ª Go -- Unit Tests
          run: |
            echo "âš™ï¸ Running unit tests..."
            if go test -v -race -coverprofile=coverage.out ./...; then
                echo ""
                echo "âœ… Unit tests passed successfully."
            else
                echo ""
                echo "âŒ Unit tests failed. Please fix the errors above."
                exit 1
            fi

        - name: ğŸ“Š Go -- Show Coverage Summary
          run: |
            echo "âš™ï¸ Show coverage Summary..."
            if go tool cover -func=coverage.out; then
                echo ""
                echo "âœ… Coverage summary displayed successfully."
            else
                echo ""
                echo "âŒ Failed to display coverage summary."
                exit 1
            fi
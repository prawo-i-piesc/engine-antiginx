name: Go Verification
run-name: >-
    ${{ 
        github.event_name == 'pull_request' 
        && format('Go Verification for CI: PR #{0} -> {1}', github.event.number, github.event.pull_request.title)
    }}

on:
    pull_request:
        types: [opened, synchronize, reopened]

permissions:
    contents: read

jobs:
    go-ci-test:
        name: Testing
        runs-on: ubuntu-latest
        timeout-minutes: 5

        steps:
        - name: üì• Git -- Checkout repository
          uses: actions/checkout@v6

        - name: üìò Go -- Set up
          uses: actions/setup-go@v6
          with:
            go-version-file: 'go.mod'
            cache: true

        - name: üß™ Go -- Test Module Integrity
          run: |
            echo "‚öôÔ∏è Verifying Go module integrity..."
            go mod tidy

            echo "|"
            echo "|"

            echo "‚öôÔ∏è Checking for uncommitted changes in go.mod and go.sum:"
            if ! git diff --exit-code go.mod go.sum > /dev/null 2>&1 ; then
                git diff --color=always go.mod go.sum
                echo ""
                echo "‚ùå go.mod or go.sum have uncommitted changes. Please run 'go mod tidy' and commit the changes."
                exit 1
            else
                echo ""
                echo "‚úÖ go.mod and go.sum are up to date."
            fi

        - name: üß™ Go -- Test Compilation
          run: |
            echo "‚öôÔ∏è Verifying project compilation..."
            if go build -v -o /dev/null ./...; then
                echo ""
                echo "‚úÖ Compilation successful."
            else
                echo ""
                echo "‚ùå Compilation failed. Please fix the errors above."
                exit 1
            fi
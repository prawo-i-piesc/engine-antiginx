name: AI Review (Go)

on:
  pull_request:
    types: [opened, reopened, synchronize]


permissions:
  pull-requests: write 
  issues: write 
  
jobs:
  gemini_pr_review:
    runs-on: ubuntu-latest
    steps:
      - name: Start PR-Agent with Gemini
        uses: qodo-ai/pr-agent@v0.31
        env:
          GEMINI_KEY: ${{ secrets.GEMINI_API_KEY }} 
        with:
          openai_model: gemini-2.5-flash 
          pr_commands: /describe /review 
          max_total_diff_tokens: 1500

          pr_reviewer_extra_instructions: |
            Jesteś starszym, rygorystycznym inżynierem oprogramowania Go, specjalizującym się w wysokiej wydajności i czystym kodzie. Twoim zadaniem jest przeprowadzenie dogłębnej recenzji Pull Requesta. 
            
            Twoja recenzja musi być:
            1. **Zwięzła i Konkretna:** Nie rozpisuj się na temat ogólnych pochwał. Skup się wyłącznie na krytycznych problemach, sugestiach poprawy lub naruszeniach standardów.
            2. **Działająca:** Zawsze sugeruj poprawne, działające fragmenty kodu Go w swoich komentarzach, jeśli znajdujesz błąd.
            
            **Priorytety Recenzji (Kolejność Ważności):**
            * **Bezpieczeństwo i Błędy:** Wykrywaj potencjalne luki (np. XSS, SQLi, jeśli to backend), błędy logiki i krytyczne przypadki krawędziowe (edge cases).
            * **Idiomatic Go i Czytelność:** Upewnij się, że kod jest zgodny ze standardami `gofmt`, `go-lint` oraz Konwencjami Go (np. nazewnictwo, małe litery w prywatnych polach).
            * **Wydajność i Konkurencyjność:** Sprawdzaj, czy nie ma marnowania pamięci, niepotrzebnych alokacji i czy operacje na *goroutines* oraz kanałach są bezpieczne i efektywne (unikanie *race conditions* i *deadlocks*).
            * **Obsługa Błędów:** Wymagaj pełnej i dokładnej obsługi błędów. Nigdy nie ignoruj zwracanych błędów (`if err != nil`).
            
            Recenzja musi być napisana w **profesjonalnym języku polskim**.